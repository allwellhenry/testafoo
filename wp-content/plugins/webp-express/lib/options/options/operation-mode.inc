<?php
$operationMode = $config['operation-mode'];
?>
<fieldset class="block">
<h3>Operation mode: <?php echo helpIcon('<p>Think of the operation modes as presets that matches normal use-cases. Usually you want to stick with <i>Standard</i> or perhaps <i>Just convert</i>. The Tweaked mode has no presets. That is: Here, you can set all options.</p><p>Changing from ie. "Standard" mode to "Tweaked" mode enables you to see the underlying options for that mode (and tweak them). Changing back will override the tweaks (you will lose them).</p><p>You will never loose your converter configurations by changing mode</p>');?>
<input type="hidden" name="operation-mode" id="operation_mode" value="<?php echo $operationMode ?>">
<select name="change-operation-mode" id="change_operation_mode">
    <option value="standard"<?php if ($operationMode == 'standard') echo ' selected'?>>Standard</option>
    <option value="just-convert"<?php if ($operationMode == 'just-convert') echo ' selected'?>>Just convert</option>
    <option value="just-redirect"<?php if ($operationMode == 'just-redirect') echo ' selected'?>>Just redirect</option>
    <option value="tweaked"<?php if ($operationMode == 'tweaked') echo ' selected'?>>Tweaked</option>
</select></h3>

<?php if ($config['operation-mode'] == 'standard') : ?>
<p><div>
    <i>In standard mode, WebP Express takes care of serving autogenerated WebP images instead of jpeg/png to browsers that supports WebP.</i>
    <div class="help">?<div class="popup">
        <i>WebP Express serves webp to browsers that supports it by redirecting
        the original image request (internally on server, it is not a 301 redirect).
        If no webp is yet generated, the request will be redirected to the image converter
        which generates the webp. On subsequent requests, the image is redirected (again, internally) directly
        to the webp, by means of a rule in the .htaccess.</i>
        </div>
    </div>
</div></p>
<?php endif; ?>
<?php if ($config['operation-mode'] == 'just-convert') : ?>
<p><div>
    <i>In "just convert" mode, WebP Express is used just for converting.<br>
    Combined with a plugin that can alter HTML for webp-use (ie <a target="_blank" href="https://da.wordpress.org/plugins/cache-enabler/">Cache Enabler</a> or <a target="_blank" href="https://wordpress.org/plugins/shortpixel-image-optimiser/">Shortpixel</a>), the redirection trick can be avoided.</i>
    <div class="help">?<div class="popup">
        <p>
            Benefits of avoiding the redirection trick:
            <ol>
                <li>CDN's will not have to be set up to forward the Accept header</li>
                <li>If a user downloads an image, it will not have wrong file extension</li>
            </ol>
            PS: Instructions for using WebPExpress with Cache Enabler and Shortpixel are found in the FAQ
        </p>
        <p>
            PPS: Images refererenced from CSS or added dynamically with javascript will not be served as webp in this mode.
        </p>
    </div>
    </div>
    <br><br>
    <i>An auto-convert option is available!</i>
    <div class="help">?<div class="popup">
        <em>The auto-convertion works this way: When an image is requested, a rule in the .htaccess detects if
        that image has been converted. If not, the request is redirected to the converter, which creates the
        webp and returns <em>the original</em> image</em>
        </div>
    </div>
</div></p>
<?php endif; ?>
<?php if ($config['operation-mode'] == 'just-redirect') : ?>
<p>
    <div>
        <i>In "just redirect" mode, WebP Express is used just for redirecting jpeg and pngs to existing webp images in the same folder.<br>
        This mode can for example be used in combination with Optimus HQ.</i>
    </div>
</p>
<?php endif; ?>
</fieldset>
<!--
<p><div>
    <i>WebP Express takes care of serving autogenerated WebP images instead of jpeg/png to browsers that supports WebP.</i>
    <div class="help">?<div class="popup"><ol>
        <li>Some redirect rules set up in <i>.htaccess</i> redirects (unconverted) jpeg/png images to a PHP script for handling.</li>
        <li>The PHP script reads the options and passes them to the <i><a target="_blank" href="https://github.com/rosell-dk/webp-convert/">WebP Convert</a></i> library for converting <i>and</i> serving.</li>
        <li>If WebP Convert finds that the image already is converted, it will be served immediately (unless it is bigger than the original, or the original has been modified). Otherwise it will be converted and then served</li>
    </ol></div></div>
</div></p>
-->
